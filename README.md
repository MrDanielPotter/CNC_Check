
# CNC Checklist – Нестинг (Компакт) — v1.2

Готовый skeleton-проект под Kivy/KivyMD + SQLite + ReportLab + Pillow + plyer.

## Что внутри

- `main.py` — приложение, экраны: старт, чек-лист, история, настройки.
- `db.py` — SQLite ORM-лайт с схемой (сессии, шаги, версии, фото, логи, отчёты, настройки).
- `security.py` — PBKDF2-HMAC-SHA256, дефолтные PIN'ы (2468/8642), флаг обязательной смены.
- `pdf_report.py` — генерация PDF с кириллицей (шрифт DejaVuSans.ttf), сжатие фото.
- `email_utils.py` — отправка отчёта по SMTP.
- `kv/ui.kv` — интерфейс KivyMD: крупные кнопки, прогресс, подсказки, цвета статусов.
- `checklist.json` — фиксированный чек-лист (встроенный, редактировать кодом при необходимости).
- `assets/DejaVuSans.ttf` — **добавьте файл** для корректной кириллицы в PDF (положите сюда вручную).
- `buildozer.spec` — конфигурация сборки APK.

## Сборка APK

1. Установите buildozer и android SDK/NDK на Linux.
2. Добавьте `assets/DejaVuSans.ttf`.
3. (Опционально) Проверьте `requirements` и `android.permissions`.
4. Выполните:
   ```bash
   cd cnc_checklist_app_v1_2
   buildozer android debug
   ```

## Замечания к реализации

- **SAF (выбор папки):** используется `androidstorage4kivy` (на Desktop — fallback через plyer.filechooser).
- **Камера:** через `plyer.camera.take_picture`. На Desktop — выбор файла-изображения.
- **PIN-блокировка 5 попыток/5 минут:** трекер попыток можно дописать через `settings` (ключи `pin_try_count_*` и `pin_lock_until_*`).
- **История:** список отчётов из таблицы `reports`, клик — открыть внешним средством (в коде — заглушка/toast).
- **Автосохранение:** состояние шагов пишется сразу; планировщик оставлен на будущее.
- **Критические пункты:** при `✗` запрашивается мастер-PIN, логируется обход.

## Приёмочные критерии

- Один фиксированный чек-лист.
- Кнопки «Подсказка» для каждого пункта.
- Время начала/окончания/длительность фиксируются и уходят в PDF.
- Блокировка по критическим пунктам требует мастер-PIN.
- PDF с кириллицей и фото, авто-нумерация отчётов (SEQ).
- История и фильтр по заказу.
- Отправка по e-mail (после заполнения SMTP).
- Журнал событий (экспорт в CSV).

## Зависимости

- kivy==2.3.0, kivymd, reportlab, pillow, plyer, androidstorage4kivy

